apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: board-backend
  namespace: argocd
  finalizers:
    - resources-finalizer.argocd.argoproj.io
spec:
  project: default

  source:
    repoURL: https://github.com/Suehyun666/Board_BE.git  # 실제 레포지토리 URL로 변경
    targetRevision: master
    path: k8s

  destination:
    server: https://kubernetes.default.svc
    namespace: board-app  # 애플리케이션을 배포할 네임스페이스

  syncPolicy:
    automated:
      prune: true      # 매니페스트에서 제거된 리소스 자동 삭제
      selfHeal: true   # Git과 클러스터 상태가 다를 경우 자동으로 동기화
      allowEmpty: false
    syncOptions:
      - CreateNamespace=true  # 네임스페이스가 없으면 자동 생성
    retry:
      limit: 5
      backoff:
        duration: 5s
        factor: 2
        maxDuration: 3m

  # 무시할 차이 설정 (불필요한 sync 방지)
  ignoreDifferences:
    - group: apps
      kind: Deployment
      jsonPointers:
        - /spec/replicas  # HPA 사용 시 replica 차이 무시
